<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Issues</title>
  <!-- Bootstrap CSS -->
  <link 
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" 
    rel="stylesheet">
  <link rel="stylesheet" href="/styles.css">
</head>
<body class="bg-light">
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="#">VR</a>
        <button 
            class="navbar-toggler" 
            type="button" 
            data-bs-toggle="collapse" 
            data-bs-target="#navbarNav" 
            aria-controls="navbarNav" 
            aria-expanded="false" 
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="/">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/about">About</a>
                </li>
                <% if(!user) { %>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/user/login">Login</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/user/register">Register</a>
                </li>
                <% } else { %>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/user/logout">Logout</a>
                </li>
                <% } %>
            </ul>
            <!-- Search Bar -->
            <form class="d-flex" action="/allIssues/search" >
                <input 
                    class="form-control me-2" 
                    type="search" 
                    name="query" 
                    placeholder="Search" 
                    aria-label="Search">
                <button class="btn btn-outline-light" type="submit">Search</button>
            </form>
        </div>
    </div>
</nav>
</header>

  <main class="container my-4">
    <% if (issues.length > 0) { %>
      <% issues.forEach(issue => { %>
        <div class="card mb-4 shadow-sm">
          <div class="card-header bg-light d-flex align-items-center">
            <span class="text-primary fw-bold">@<%= issue.username %></span>
          </div>
          <div class="card-body">
            <h5 class="card-title"><%= issue.title %></h5>
            <p class="card-text"><%= issue.description %></p>
            <!-- Media Section -->
            <div class="mt-3">
              <% if (issue.imageURL) { %>
                <img 
                  src="<%= issue.imageURL %>" 
                  class="img-fluid rounded mb-2" 
                  style="max-width: 100%; max-height: 400px; object-fit: cover; cursor: pointer;" 
                  alt="Issue Image" 
                  data-bs-toggle="modal" 
                  data-bs-target="#mediaModal" 
                  data-media-type="image" 
                  data-src="<%= issue.imageURL %>"
                >
              <% } %>
              <% if (issue.videoURL) { %>
                <video 
                  class="img-fluid rounded" 
                  style="max-width: 100%; max-height: 400px; object-fit: cover; cursor: pointer;" 
                  controls 
                  muted
                  data-bs-toggle="modal" 
                  data-bs-target="#mediaModal" 
                  data-media-type="video" 
                  data-src="<%= issue.videoURL %>"
                >
                  <source src="<%= issue.videoURL %>" type="video/mp4">
                </video>
              <% } %>
            </div>
          </div>
          <div class="card-footer d-flex justify-content-between align-items-center bg-light">
            <div class="vote-actions">
              <a href="/allIssues/<%= issue._id %>/<%= user.id %>/upvote" class="btn btn-sm ">
                ⬆️ <%= issue.upVotes.length %>
              </a>
              <a href="/allIssues/<%= issue._id %>/<%= user.id %>/downvote" class="btn btn-sm ">
                ⬇️ <%= issue.downVotes.length %>
              </a>
            </div>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <p class="text-center text-muted fs-5">No issues found. Check back later!</p>
    <% } %>
  </main>

  <!-- Bootstrap JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
